package main

import (
	"fmt"
	"github.com/go-rod/rod"
	"os"
	"strings"
	"testing"
)

func TestParseLink(t *testing.T) {
	body := `<!DOCTYPE html PUBLIC \"-\/\/W3C\/\/DTD XHTML 1.0 Transitional\/\/EN\" \"http:\/\/www.w3.org\/TR\/xhtml1\/DTD\/xhtml1-transitional.dtd\">\n<html xmlns=\"http:\/\/www.w3.org\/1999\/xhtml\" xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\">\n<head>\n<!-- MonitorCampaignID: verify_email -->\n\n<!--[if gte mso 9]>\n<xml>\n<o:OfficeDocumentSettings>\n<o:AllowPNG\/>\n<o:PixelsPerInch>96<\/o:PixelsPerInch>\n<\/o:OfficeDocumentSettings>\n<\/xml>\n<![endif]-->\n<meta http-equiv=\"Content-type\" content=\"text\/html; charset=utf-8\" \/>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1\" \/>\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" \/>\n<meta name=\"format-detection\" content=\"date=no\" \/>\n<meta name=\"format-detection\" content=\"address=no\" \/>\n<meta name=\"format-detection\" content=\"telephone=no\" \/>\n<meta name=\"x-apple-disable-message-reformatting\" \/>\n<!--[if !mso]><!-->\n<!--<![endif]-->\n<title>Email Template<\/title>\n<!--[if gte mso 9]>\n<style type=\"text\/css\" media=\"all\">\nsup { font-size: 100% !important; }\n<\/style>\n<![endif]-->\n\n\n<style type=\"text\/css\" media=\"screen\">\nbody { padding:0 !important; margin:0 auto !important; display:block !important; min-width:100% !important; width:100% !important; background:#ffffff; -webkit-text-size-adjust:none }\na { color:#313e42; text-decoration:none }\np { padding:0 !important; margin:0 !important }\nimg { margin: 0 !important; -ms-interpolation-mode: bicubic; \/* Allow smoother rendering of resized image in Internet Explorer *\/ }\n\na[x-apple-data-detectors] {\ncolor: inherit !important;\ntext-decoration: inherit !important;\nfont-size: inherit !important;\nfont-family: inherit !important;\nfont-weight: inherit !important;\nline-height: inherit !important;\n}\n\n.btn-12 a { display: block; padding: 4px; text-decoration: none; }\n.btn-14 a { display: block; padding: 8px; text-decoration: none; }\n.btn-14-4 a { display: block; padding: 8px; text-decoration: none; }\n\n.l-red a { color: #ff0000; }\n\n\n\/* Mobile styles *\/\n@media only screen and (max-device-width: 480px), only screen and (max-width: 480px) {\n.mpx-16 { padding-left: 16px !important; padding-right: 16px !important; }\n\n.mpb-20 { padding-bottom: 20px !important; }\n\n.mpb-40 { padding-bottom: 40px !important; }\n\n.mfz-14 { font-size: 14px !important; }\n\n.mlh-16 { line-height: 16px !important; }\n\n.mpb-28 { padding-bottom: 28px !important; }\n\n.mlh-18 { line-height: 18px !important; }\n\n.mpb-34 { padding-bottom: 34px !important; }\n\n.mpt-16 { padding-top: 16px !important; }\n\n.mpt-34 { padding-top: 34px !important; }\n\n.mpx-12 { padding-left: 12px !important; padding-right: 12px !important; }\n\n.mfz-12 { font-size: 12px !important; }\n\n.mpb-8 { padding-bottom: 8px !important; }\n\nu + .body .gwfw { width:100% !important; width:100vw !important; }\n\n.td,\n.m-shell { width: 100% !important; min-width: 100% !important; }\n\n.mt-left { text-align: left !important; }\n.mt-center { text-align: center !important; }\n.mt-right { text-align: right !important; }\n\n.me-left { margin-right: auto !important; }\n.me-center { margin: 0 auto !important; }\n.me-right { margin-left: auto !important; }\n\n.h-auto { height: auto !important; }\n.w-auto { width: auto !important; }\n\n.fluid-img img { width: 100% !important; max-width: 100% !important; height: auto !important; }\n\n.column,\n.column-top,\n.column-dir,\n.column-dir-top { float: left !important; width: 100% !important; display: block !important; }\n\n.m-hide { display: none !important; width: 0 !important; height: 0 !important; font-size: 0 !important; line-height: 0 !important; min-height: 0 !important; }\n.m-block { display: block !important; }\n\n\/*Width*\/\n.w-15 { width: 15px !important; }\n\n.w-8 { width: 8px !important; height: auto !important; }\n\n.w-12 { width: 12px !important; height: auto !important; }\n\n.w-60 { width: 60px !important; height: auto !important; }\n\n.w-54 { width: 54px !important; height: auto !important; }\n.w-54 img { width: 54px !important; height: auto !important; }\n\n.w-104 { width: 104px !important; height: auto !important; }\n.w-104 img { width: 104px !important; height: auto !important; }\n\n.w-114 { width: 114px !important; height: auto !important; }\n.w-114 img { width: 114px !important; height: auto !important; }\n\n.btn-14-4 { font-size: 12px !important; line-height: 16px !important; }\n.btn-14-4 a { padding: 4px !important; }\n\n.w-2p { width: 2% !important; }\n.w-32p { width: 32% !important; }\n.w-49p { width: 49% !important; }\n.w-50p { width: 50% !important; }\n.w-100p { width: 100% !important; }\n\n\/*Text*\/\n\n}\n<\/style>\n<\/head>\n<body class=\"body\" style=\"padding:0 !important; margin:0 auto !important; display:block !important; min-width:100% !important; width:100% !important; background:#ffffff; -webkit-text-size-adjust:none;\">\n<center>\n<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"margin: 0; padding: 0; width: 100%;\" bgcolor=\"#ffffff\" class=\"gwfw\">\n<tr>\n<td style=\"margin: 0; padding: 0; width: 100%;\" align=\"center\">\n<table width=\"600\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"m-shell\">\n<tr>\n<td class=\"td\" style=\"width:600px; min-width:600px; font-size:0pt; line-height:0pt; padding:0; margin:0; font-weight:normal;\">\n<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n\n<!-- Verify your email address -->\n<tr>\n<td class=\"img\" style=\"font-size:0pt; line-height:0pt; text-align:left;\">\n<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tr>\n<td class=\"px-32 mpx-16\" style=\"padding-left: 32px; padding-right: 32px;\">\n<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tr>\n<td class=\"pt-25 pt-16 pb-28 mpb-20\" style=\"padding-top: 16px; padding-bottom: 28px;\">\n<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tr>\n<td class=\"pb-54 mpb-40\" style=\"padding-bottom: 54px;\">\n<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tr>\n<td class=\"img w-104\" width=\"112\" style=\"font-size:0pt; line-height:0pt; text-align:left;\"><a href=\"https:\/\/www.reddit.com\/\" target=\"_blank\"><img src=\"https:\/\/www.redditstatic.com\/emaildigest\/logo@2x.png\" width=\"112\" height=\"39\" border=\"0\" alt=\"\" \/><\/a><\/td>\n<td class=\"img\" width=\"20\" style=\"font-size:0pt; line-height:0pt; text-align:left;\"><\/td>\n<td class=\"img\" style=\"font-size:0pt; line-height:0pt; text-align:left;\">\n<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tr>\n<td align=\"right\">\n<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tr>\n<td class=\"img\" width=\"16\" valign=\"top\" style=\"font-size:0pt; line-height:0pt; text-align:left;\"><img src=\"https:\/\/www.redditstatic.com\/emaildigest\/user_default_icon_small.png\" width=\"16\" height=\"16\" border=\"0\" alt=\"\" \/><\/td>\n<td class=\"img\" width=\"4\" style=\"font-size:0pt; line-height:0pt; text-align:left;\"><\/td>\n<td class=\"text-12 c-grey-4\" style=\"font-size:12px; line-height:14px; font-family:Helvetica, Arial, sans-serif; text-align:left; min-width:auto !important; color:#7a9299;\"><a href=\"https:\/\/www.reddit.com\/user\/yqnkmtphzpemmzkhct\/?correlation_id=fa409d8d-9806-4109-9e8f-0002f5663f9e&amp;email_type=verify_email&amp;ref=verify_email&amp;ref_campaign=verify_email&amp;ref_source=email\" target=\"_blank\" class=\"link c-grey-4\" style=\"text-decoration:none; color:#7a9299;\"><span class=\"link c-grey-4\" style=\"text-decoration:none; color:#7a9299;\">u\/yqnkmtphzpemmzkhct<\/span><\/a><\/td>\n<\/tr>\n<\/table>\n<\/td>\n<\/tr>\n<\/table>\n<\/td>\n<\/tr>\n<\/table>\n<\/td>\n<\/tr>\n<tr>\n<td class=\"text-16 mfz-14 mlh-16 pb-34\" style=\"font-size:16px; line-height:18px; color:#000000; font-family:Helvetica, Arial, sans-serif; text-align:left; min-width:auto !important; padding-bottom: 34px;\">\nHi there,\n<br \/><br \/>\n\nYour email address <a target=\"_blank\" class=\"link c-dark-3\" style=\"text-decoration:none; color:#000000;\"><span class=\"link c-dark-3\" style=\"text-decoration:none; color:#000000;\">mtwxzyyswkxapfvvzm@1secmail.com<\/span><\/a> has been added to your <span class=\"link c-dark-3\" style=\"text-decoration:none; color:#000000;\">yqnkmtphzpemmzkhct<\/span> Reddit account. But wait, we&rsquo;re not done yet...\n<br \/><br \/>\n\nTo finish verifying your email address and securing your account, <span class=\"link c-dark-3\" style=\"text-decoration:none; color:#000000;\">click the button below<\/span>.\n<\/td>\n<\/tr>\n<tr>\n<td class=\"pb-40 mpb-28\" align=\"center\" style=\"padding-bottom: 40px;\">\n<table width=\"214\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tr>\n<td class=\"btn-14\" bgcolor=\"#0079d3\" style=\"border-radius: 4px; font-size:14px; line-height:18px; mso-padding-alt:8px; color:#ffffff; font-family:Helvetica, Arial, sans-serif; text-align:center; min-width:auto !important;\"><a href=\"https:\/\/www.reddit.com\/verification\/FBQW9aeThaRExaeXlsXzJzbk03SGhxcWpsektNX1lUczJWYldDYVg1T25XbGJSMjFaYiJ9?correlation_id=fa409d8d-9806-4109-9e8f-0002f5663f9e&amp;ref=verify_email&amp;ref_campaign=verify_email&amp;ref_source=email\" target=\"_blank\" class=\"link c-white\" style=\"display: block; padding: 8px; text-decoration:none; color:#ffffff;\"><span class=\"link c-white\" style=\"text-decoration:none; color:#ffffff;\"><strong>Verify Email Address<\/strong><\/span><\/a><\/td>\n<\/tr>\n<\/table>\n<\/td>\n<\/tr>\n<tr>\n<td class=\"text-16 mfz-14 mlh-16 pb-16\" style=\"font-size:16px; line-height:18px; color:#000000; font-family:Helvetica, Arial, sans-serif; text-align:left; min-width:auto !important; padding-bottom: 28px;\">\n(And don\u2019t wait too long. This link will only work for 3 days and you can only use it once.)\n<\/td>\n<\/tr>\n<tr>\n<td class=\"text-16 mfz-14 mlh-16 pb-16\" style=\"font-size:16px; line-height:18px; color:#000000; font-family:Helvetica, Arial, sans-serif; text-align:left; min-width:auto !important; padding-bottom: 28px;\">\nExpired link? No worries! To get a new verification email, visit your <a href=\"https:\/\/new.reddit.com\/settings\/account\" target=\"_blank\" class=\"link c-blue\" style=\"text-decoration:none; color:#006cbf;\"><span class=\"link c-blue\" style=\"text-decoration:none; color:#006cbf;\">Account Settings<\/span><\/a>, select <em>Update email address<\/em>, then hit <em>Resend Verification Email<\/em>.\n<\/td>\n<\/tr>\n<tr>\n<td class=\"text-16 mfz-14 mlh-16 pb-28\" style=\"font-size:16px; line-height:18px; color:#000000; font-family:Helvetica, Arial, sans-serif; text-align:left; min-width:auto !important; padding-bottom: 28px;\">\nIf yqnkmtphzpemmzkhct isn&rsquo;t your Reddit account, <a href=\"https:\/\/www.reddit.com\/remove_email\/t2_fu2imr2n4\/eyJhY2NvdW50X2lkIjogInQyX2Z1MmltcjJuNCIsICJzaWciOiAiQVFBQW9aeThaTURsaWx6SWRqYlVMT1RTS0xiMzJCN1hlMlN0Sm5vSFdiSEQ2VmlocUZzXyJ9?correlation_id=fa409d8d-9806-4109-9e8f-0002f5663f9e&amp;ref=verify_email&amp;ref_campaign=verify_email&amp;ref_source=email\" target=\"_blank\" class=\"link c-blue\" style=\"text-decoration:none; color:#006cbf;\"><span class=\"link c-blue\" style=\"text-decoration:none; color:#006cbf;\">let us know<\/span><\/a> and we&rsquo;ll make sure nothing weird is going on.\n<\/td>\n<\/tr>\n<\/table>\n<\/td>\n<\/tr>\n<\/table>\n<\/td>\n<\/tr>\n<\/table>\n<\/td>\n<\/tr>\n<!-- END Verify your email address -->\n\n<!-- Footer - 2 -->\n<tr>\n<td class=\"pb-34 mpb-20\" bgcolor=\"#f1f5f6\" style=\"padding-bottom: 34px;\">\n<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tr>\n<td class=\"fluid-img mpb-8\" style=\"font-size:0pt; line-height:0pt; text-align:left;\"><a href=\"https:\/\/www.reddit.com\/\" target=\"_blank\"><img src=\"https:\/\/www.redditstatic.com\/emaildigest\/footer_logo_8_8.png\" width=\"600\" height=\"125\" border=\"0\" alt=\"\" \/><\/a><\/td>\n<\/tr>\n<tr>\n<td class=\"pb-40 mpb-20\" align=\"center\" style=\"padding-bottom: 40px;\">\n<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tr>\n<td class=\"img w-114\" valign=\"top\" style=\"font-size:0pt; line-height:0pt; text-align:left;\"><a href=\"https:\/\/apps.apple.com\/us\/app\/reddit\/id1064216828\" target=\"_blank\"><img src=\"https:\/\/www.redditstatic.com\/emaildigest\/app_store_8_8.png\" width=\"124\" height=\"37\" border=\"0\" alt=\"\" \/><\/a><\/td>\n<td class=\"img w-8\" width=\"10\" style=\"font-size:0pt; line-height:0pt; text-align:left;\"><\/td>\n<td class=\"img w-114\" valign=\"top\" style=\"font-size:0pt; line-height:0pt; text-align:left;\"><a href=\"https:\/\/play.google.com\/store\/apps\/details?id=com.reddit.frontpage\" target=\"_blank\"><img src=\"https:\/\/www.redditstatic.com\/emaildigest\/google_play_8_8.png\" width=\"124\" height=\"37\" border=\"0\" alt=\"\" \/><\/a><\/td>\n<\/tr>\n<\/table>\n<\/td>\n<\/tr>\n<tr>\n<td class=\"text-16-8 mfz-12 mlh-18 c-dark-8-8 a-center px-24 mpx-12\" style=\"font-size:16px; line-height:18px; font-family:Helvetica, Arial, sans-serif; min-width:auto !important; color:#222222; text-align:center; padding-left: 24px; padding-right: 24px;\">548 Market St., #16093, San Francisco, CA 94104\u20135401<\/td>\n<\/tr>\n<\/table>\n<\/td>\n<\/tr>\n<!-- END Footer - 2 -->\n<\/table>\n<\/td>\n<\/tr>\n<\/table>\n<\/td>\n<\/tr>\n<\/table>\n<\/center>\n<img alt=\"\" src=\"https:\/\/ql9whnmm.r.us-east-1.awstrack.me\/I0\/010001897150c24d-b0d926c9-8390-4ae3-ac61-dc16b49f4094-000000\/NY2Nj_IME_v0mF18huIFbzk5C8A=331\" style=\"display: none; width: 1px; height: 1px;\">\n<\/body>\n<\/html>\n`
	index := strings.Index(body, `https:\/\/www.reddit.com\/verification\/`)
	end := strings.Index(body[index:], `\"`)
	link := body[index : index+end]
	fmt.Println(link)
}

func TestVerifyClick(t *testing.T) {
	url := `https://www.reddit.com/verification/jogInQyX2Z2YWFsbTZvMCIsICJzaWciOiAiQVFBQTZFSzlaRFlIdTVOcDB3WHRTZFV6WTluZUF4TU9zSjRaWXB3cmJoSTYySzg1WXVrSyJ9?correlation_id=1999df97-fcff-456c-937e-80fcc7af9989&amp;ref=verify_e`

	browser := rod.New().MustConnect()
	page := browser.MustPage(url)
	page.WaitLoad()

	bytes, _ := page.Screenshot(true, nil)
	os.WriteFile(fmt.Sprintf("screenshot%d.png", index), bytes, 0644)

	fmt.Println(page.Has("#verify-email > button"))
}
